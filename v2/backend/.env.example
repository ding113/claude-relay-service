# üöÄ Claude Relay Service v2 Configuration

# üåê Server Configuration
NODE_ENV=development
PORT=4000
HOST=0.0.0.0

# üîê Security Configuration (‚ö†Ô∏è MUST CHANGE IN PRODUCTION)
JWT_SECRET=your-super-secret-jwt-key-at-least-32-characters-long
ENCRYPTION_KEY=12345678901234567890123456789012  # Must be exactly 32 characters
ADMIN_SESSION_TIMEOUT=86400000
API_KEY_PREFIX=cr_

# üë§ Admin Credentials (optional, auto-generated if not set)
# ADMIN_USERNAME=cr_admin_custom
# ADMIN_PASSWORD=your-secure-password

# üìä Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=1  # v2 uses DB 1 (v1 uses DB 0)
REDIS_ENABLE_TLS=false

# üîó Session Management Configuration
# Sticky session TTL (hours), default 1 hour
STICKY_SESSION_TTL_HOURS=1
# Renewal threshold (minutes), default 15 minutes
STICKY_SESSION_RENEWAL_THRESHOLD_MINUTES=15

# üéØ Claude API Configuration
CLAUDE_API_URL=https://api.anthropic.com/v1/messages
CLAUDE_API_VERSION=2023-06-01
CLAUDE_BETA_HEADER=claude-code-20250219,oauth-2025-04-20,interleaved-thinking-2025-05-14,fine-grained-tool-streaming-2025-05-14
# 529 error handling: 0=disabled, >0=overload state duration (minutes)
CLAUDE_OVERLOAD_HANDLING_MINUTES=0

# üåê Proxy Configuration
DEFAULT_PROXY_TIMEOUT=600000
MAX_PROXY_RETRIES=3
# IP protocol: true=IPv4, false=IPv6, default IPv4 (better compatibility)
PROXY_USE_IPV4=true

# ‚è±Ô∏è Request Timeout Configuration
REQUEST_TIMEOUT=600000  # Request timeout (milliseconds), default 10 minutes

# üìà Usage Limits
DEFAULT_TOKEN_LIMIT=1000000

# üïê Timezone Configuration
TIMEZONE_OFFSET=8  # UTC offset hours, default +8 (China timezone)

# üìä Metrics Configuration
METRICS_WINDOW=5  # Real-time metrics window (minutes), 1-60, default 5

# üìù Logging Configuration
LOG_LEVEL=info
LOG_PRETTY=true
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5

# üîß System Configuration
CLEANUP_INTERVAL=3600000
TOKEN_USAGE_RETENTION=2592000000
HEALTH_CHECK_INTERVAL=60000

# üé® Web Interface Configuration
WEB_TITLE=Claude Relay Service
WEB_DESCRIPTION=Multi-account Claude API relay service with beautiful management interface
WEB_LOGO_URL=/assets/logo.png

# üõ†Ô∏è Development Configuration
DEBUG=false
DEBUG_HTTP_TRAFFIC=false  # Enable HTTP request/response debug logs (dev only)
ENABLE_CORS=true
TRUST_PROXY=true

# üîí Client Restrictions (optional)
ALLOW_CUSTOM_CLIENTS=true

# üîê LDAP Authentication Configuration (optional)
LDAP_ENABLED=false
LDAP_URL=ldaps://ldap-1.test1.bj.yxops.net:636
LDAP_BIND_DN=cn=admin,dc=example,dc=com
LDAP_BIND_PASSWORD=admin_password
LDAP_SEARCH_BASE=dc=example,dc=com
LDAP_SEARCH_FILTER=(uid={{username}})
LDAP_SEARCH_ATTRIBUTES=dn,uid,cn,mail,givenName,sn
LDAP_TIMEOUT=5000
LDAP_CONNECT_TIMEOUT=10000

# üîí LDAP TLS/SSL Configuration (for ldaps:// URLs)
# Ignore certificate validation errors (set to false for self-signed certs)
LDAP_TLS_REJECT_UNAUTHORIZED=true
# CA certificate file path (optional, for custom CA certs)
# LDAP_TLS_CA_FILE=/path/to/ca-cert.pem
# Client certificate file path (optional, for mutual TLS)
# LDAP_TLS_CERT_FILE=/path/to/client-cert.pem
# Client private key file path (optional, for mutual TLS)
# LDAP_TLS_KEY_FILE=/path/to/client-key.pem
# Server name (optional, for SNI)
# LDAP_TLS_SERVERNAME=ldap.example.com

# üó∫Ô∏è LDAP User Attribute Mapping
LDAP_USER_ATTR_USERNAME=uid
LDAP_USER_ATTR_DISPLAY_NAME=cn
LDAP_USER_ATTR_EMAIL=mail
LDAP_USER_ATTR_FIRST_NAME=givenName
LDAP_USER_ATTR_LAST_NAME=sn

# üë• User Management Configuration
USER_MANAGEMENT_ENABLED=false
DEFAULT_USER_ROLE=user
USER_SESSION_TIMEOUT=86400000
MAX_API_KEYS_PER_USER=1
ALLOW_USER_DELETE_API_KEYS=false
